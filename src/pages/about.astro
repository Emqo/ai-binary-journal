---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { GITHUB_URL, SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getGitHubSnapshot } from '../lib/github';

const github = await getGitHubSnapshot();
const profileRepo = github.repos.find((repo) => repo.name.toLowerCase() === github.profile.login.toLowerCase());
const primaryRepos = github.repos.filter((repo) => !repo.fork).slice(0, 5);
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title={`关于 | ${SITE_TITLE}`} description={SITE_DESCRIPTION} />
		<style>
			.about-wrap {
				display: grid;
				gap: 1rem;
			}
			.header-line {
				display: flex;
				align-items: center;
				gap: 0.9rem;
			}
			.avatar {
				width: 72px;
				height: 72px;
				border-radius: 18px;
				border: 1px solid var(--line);
			}
			.repo-list {
				margin: 0;
				padding-left: 1.2rem;
			}
			.repo-list li {
				margin-bottom: 0.35rem;
			}
			.link-row {
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
			}
			.link-row a {
				text-decoration: none;
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<section class="about-wrap">
				<article class="card">
					<div class="header-line">
						<img class="avatar" src={github.profile.avatarUrl} alt="avatar" />
						<div>
							<h1>{github.profile.name}</h1>
							<p>{github.profile.bio}</p>
						</div>
					</div>
					<div class="meta-line">
						<span class="chip" data-kind="accent">@{github.profile.login}</span>
						<span class="chip">账号创建 {github.profile.createdAt.toLocaleDateString('zh-CN')}</span>
						<span class="chip">公开仓库 {github.profile.publicRepos}</span>
					</div>
					<div class="link-row">
						<a class="chip" data-kind="accent" href={GITHUB_URL} target="_blank">GitHub</a>
						{
							profileRepo && (
								<a class="chip" href={profileRepo.url} target="_blank">Profile README Repo</a>
							)
						}
						<a class="chip" href="/projects">Projects 页面</a>
					</div>
				</article>

				<article class="card">
					<h2>技术方向</h2>
					<p>
						博客重点聚焦 <strong>AI + Binary Engineering</strong>：逆向工程、系统底层、LLM 工程化与自动化分析流程。
					</p>
					<div class="meta-line">
						{github.topLanguages.map((item) => <span class="chip">{item.language} ({item.count})</span>)}
					</div>
				</article>

				<article class="card">
					<h2>近期活跃项目</h2>
					<ul class="repo-list">
						{
							primaryRepos.map((repo) => (
								<li>
									<a href={repo.url} target="_blank">{repo.name}</a> · {repo.language ?? 'Unknown'}
								</li>
							))
						}
					</ul>
				</article>

				<article class="card">
					<h2>同步策略</h2>
					<ul>
						<li>首页和项目页在构建时从 GitHub API 拉取公开数据。</li>
						<li>仓库更新后，重新部署即可同步到站点内容。</li>
						<li>文章体系与项目演进保持同一叙事线，避免站点和仓库割裂。</li>
					</ul>
				</article>
			</section>
		</main>
		<Footer />
	</body>
</html>
